---

- name: Adding users
  template: >
    src=etc-sudoers-d-ansible.j2
    dest=/etc/sudoers.d/ansible
    validate='visudo -cf %s'
    owner=root
    group=root
    mode=0440
  when: not file_per_sudoer
  tags:
    - system
    - sudo
    - config


- name: Adding users
  template: >
    src=etc-sudoers-d-user.j2
    dest=/etc/sudoers.d/{{item.name | replace('%', 'group_') }}
    validate='visudo -cf %s'
    owner=root
    group=root
    mode=0440
  with_items: sudo_users
  when: file_per_sudoer
  tags:
    - system
    - sudo
    - config
